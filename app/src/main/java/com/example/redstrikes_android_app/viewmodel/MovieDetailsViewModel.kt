package com.example.redstrikes_android_app.viewmodel

import android.content.Context
import android.content.Intent
import androidx.lifecycle.SavedStateHandle
import androidx.lifecycle.ViewModel
import com.example.redstrikes_android_app.data.Movie
import dagger.hilt.android.lifecycle.HiltViewModel
import javax.inject.Inject

@HiltViewModel
class MovieDetailsViewModel @Inject constructor(
    private val savedStateHandle: SavedStateHandle
) : ViewModel() {
    private val movies = listOf(
        Movie(
            id = 1,
            title = "–ù–∞—á–∞–ª–æ",
            year = 2010,
            rating = 8.8,
            genre = "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –ë–æ–µ–≤–∏–∫",
            director = "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –ù–æ–ª–∞–Ω",
            synopsis = "–ö–æ–±–± ‚Äî –≤–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –ø—Ä–æ–Ω–∏–∫–∞—Ç—å –≤ —Å–Ω—ã –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π –∏ –∫—Ä–∞—Å—Ç—å –∏—Ö —Å–µ–∫—Ä–µ—Ç—ã. –ù–æ –∫–æ–≥–¥–∞ –µ–º—É –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –Ω–µ —É–∫—Ä–∞—Å—Ç—å, –∞ –≤–Ω–µ–¥—Ä–∏—Ç—å –∏–¥–µ—é...",
            imageUrl = "https://avatars.mds.yandex.net/get-kinopoisk-image/1629390/8ab9a119-dd74-44f0-baec-0629797483d7/600x900",
            duration = "148 –º–∏–Ω"
        ),
        Movie(
            id = 2,
            title = "–¢–µ–º–Ω—ã–π —Ä—ã—Ü–∞—Ä—å",
            year = 2008,
            rating = 9.0,
            genre = "–ë–æ–µ–≤–∏–∫, –î—Ä–∞–º–∞, –ö—Ä–∏–º–∏–Ω–∞–ª",
            director = "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –ù–æ–ª–∞–Ω",
            synopsis = "–ë—ç—Ç–º–µ–Ω —Å—Ä–∞–∂–∞–µ—Ç—Å—è —Å –î–∂–æ–∫–µ—Ä–æ–º ‚Äî —Ö–∞–æ—Ç–∏—á–Ω—ã–º –≥–µ–Ω–∏–µ–º –ø—Ä–µ—Å—Ç—É–ø–Ω–æ–≥–æ –º–∏—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –¥–∞–∂–µ –ª—É—á—à–∏–µ –∏–∑ –ª—é–¥–µ–π –º–æ–≥—É—Ç –ø–∞—Å—Ç—å...",
            imageUrl = "https://avatars.mds.yandex.net/get-kinopoisk-image/1599028/0fa5bf50-d5ad-446f-a599-b26d070c8b99/600x900",
            duration = "152 –º–∏–Ω"
        ),
        Movie(
            id = 3,
            title = "–ò–Ω—Ç–µ—Ä—Å—Ç–µ–ª–ª–∞—Ä",
            year = 2014,
            rating = 8.6,
            genre = "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –î—Ä–∞–º–∞",
            director = "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –ù–æ–ª–∞–Ω",
            synopsis = "–ß—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–æ –æ—Ç –≤—ã–º–∏—Ä–∞–Ω–∏—è, –≥—Ä—É–ø–ø–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ —á–µ—Ä–≤–æ—Ç–æ—á–∏–Ω—É –≤ –ø–æ–∏—Å–∫–∞—Ö –Ω–æ–≤–æ–≥–æ –¥–æ–º–∞...",
            imageUrl = "https://avatars.mds.yandex.net/get-kinopoisk-image/1600647/78c36c0f-aefd-4102-bc3b-bac0dd4314d8/3840x",
            duration = "169 –º–∏–Ω"
        ),
        Movie(
            id = 4,
            title = "1+1",
            year = 2011,
            rating = 8.8,
            genre = "–î—Ä–∞–º–∞, –ö–æ–º–µ–¥–∏—è",
            director = "–û–ª–∏–≤—å–µ –ù–∞–∫–∞—à, –≠—Ä–∏–∫ –¢–æ–ª–µ–¥–∞–Ω–æ",
            synopsis = "–ë–æ–≥–∞—Ç—ã–π –∞—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç, –ø–∞—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Å–ª–µ –Ω–µ—Å—á–∞—Å—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞—è, –Ω–∞–Ω–∏–º–∞–µ—Ç –≤ —Å–∏–¥–µ–ª–∫–∏ –±—ã–≤—à–µ–≥–æ –∑–∞–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ. –ò—Ö –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –¥—Ä—É–∂–±–∞ –º–µ–Ω—è–µ—Ç –æ–±–µ –∂–∏–∑–Ω–∏...",
            imageUrl = "https://avatars.mds.yandex.net/get-kinopoisk-image/1946459/5c758ac0-7a5c-4f00-a94e-1a5607020850/600x900",
            duration = "112 –º–∏–Ω"
        )
    )

    val movie: Movie?
        get() {
            val movieIdString = savedStateHandle.get<String>("movieId")
            return movieIdString?.toIntOrNull()?.let { movieId ->
                movies.find { it.id == movieId }
            }
        }

    fun shareMovie(context: Context) {
        movie?.let { movie ->
            val shareText = """
                üé¨ ${movie.title} (${movie.year})
                
                ‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${movie.rating}/10
                üé≠ –ñ–∞–Ω—Ä: ${movie.genre}
                üé• –†–µ–∂–∏—Å—Å–µ—Ä: ${movie.director}
                ‚è± –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${movie.duration}
                
                üìñ –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
                ${movie.synopsis}
                
                –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ! –£–≤–µ—Ä–µ–Ω, –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è! üçø
                
                #—Ñ–∏–ª—å–º—ã #–∫–∏–Ω–æ–ø–æ–∏—Å–∫ #${movie.title.replace(" ", "")}
            """.trimIndent()

            val shareIntent = Intent(Intent.ACTION_SEND).apply {
                type = "text/plain"
                putExtra(Intent.EXTRA_SUBJECT, "üé¨ ${movie.title} - –†–µ–∫–æ–º–µ–Ω–¥—É—é –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É!")
                putExtra(Intent.EXTRA_TEXT, shareText)
            }
            context.startActivity(Intent.createChooser(shareIntent, "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∏–ª—å–º–æ–º"))
        }
    }

    fun getSimilarMovies(): List<Movie> {
        return movie?.let { currentMovie ->
            movies
                .filter { it.id != currentMovie.id }
                .filter {
                    // –§–∏–ª—å–º—ã —Ç–æ–≥–æ –∂–µ –∂–∞–Ω—Ä–∞ –∏–ª–∏ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞
                    it.genre.split(", ").any { genre ->
                        currentMovie.genre.contains(genre)
                    } || it.director == currentMovie.director
                }
                .take(4) // 4 –ø–æ—Ö–æ–∂–∏—Ö —Ñ–∏–ª—å–º–∞
        } ?: emptyList()
    }

    fun getMovieRatingDescription(): String {
        return movie?.rating?.let { rating ->
            when {
                rating >= 9.0 -> "üéñ –í—ã–¥–∞—é—â–∏–π—Å—è —Ñ–∏–ª—å–º (–∫–∏–Ω–æ—à–µ–¥–µ–≤—Ä)"
                rating >= 8.5 -> "‚≠ê –û—Ç–ª–∏—á–Ω—ã–π —Ñ–∏–ª—å–º (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É)"
                rating >= 8.0 -> "üëç –•–æ—Ä–æ—à–∏–π —Ñ–∏–ª—å–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)"
                rating >= 7.5 -> "üëå –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∏–ª—å–º (—Å—Ç–æ–∏—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å)"
                else -> "üé¨ –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∏–ª—å–º"
            }
        } ?: "–†–µ–π—Ç–∏–Ω–≥ –Ω–µ —É–∫–∞–∑–∞–Ω"
    }

    fun getMovieHookPhrase(): String {
        return movie?.let { movie ->
            when (movie.id) {
                1 -> "–ß—Ç–æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, –∞ —á—Ç–æ —Å–æ–Ω?"
                2 -> "–ü–æ—á–µ–º—É —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ª—é–¥–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–º–µ—à–Ω—ã–º–∏?"
                3 -> "–ß—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É —á–µ—Ä–≤–æ—Ç–æ—á–∏–Ω—ã?"
                4 -> "–ñ–∏–∑–Ω—å –∫–∞–∫ –∫–æ—Ä–æ–±–∫–∞ —à–æ–∫–æ–ª–∞–¥–Ω—ã—Ö –∫–æ–Ω—Ñ–µ—Ç..."
                5 -> "–ù–∞–¥–µ–∂–¥–∞ ‚Äî –ª—É—á—à–∞—è –∏–∑ –≤–µ—â–µ–π..."
                6 -> "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –±—É—Ä–≥–µ—Ä —Å —Å—ã—Ä–æ–º –ø–æ-–≥–æ–ª–ª–∞–Ω–¥—Å–∫–∏"
                7 -> "–û–¥–Ω–æ –∫–æ–ª—å—Ü–æ, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º–∏..."
                8 -> "–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å—Å—è, —á—Ç–æ–±—ã —Å–Ω–æ–≤–∞ –≤–∑–ª–µ—Ç–µ—Ç—å"
                9 -> "–•–∞–∫—É–Ω–∞ –ú–∞—Ç–∞—Ç–∞!"
                10 -> "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã–π –º–∏—Ä"
                11 -> "–†–∏—Å—É–π –º–µ–Ω—è, –∫–∞–∫ –æ–¥–Ω—É –∏–∑ —Å–≤–æ–∏—Ö —Ñ—Ä–∞–Ω—Ü—É–∂–µ–Ω–æ–∫"
                12 -> "–ö–∞–∂–¥—ã–π –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –≤—Ç–æ—Ä–æ–≥–æ —à–∞–Ω—Å–∞"
                else -> "–ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∏–ª—å–º!"
            }
        } ?: "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É!"
    }

    fun getWhyWatchDescription(): String {
        return movie?.let { movie ->
            when (movie.id) {
                1 -> "–ó–∞ –≥–µ–Ω–∏–∞–ª—å–Ω—É—é –∏–¥–µ—é –æ —Å–Ω–∞—Ö –≤–Ω—É—Ç—Ä–∏ —Å–Ω–æ–≤ –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã"
                2 -> "–ó–∞ –æ–¥–Ω–æ–≥–æ –∏–∑ –ª—É—á—à–∏—Ö –∑–ª–æ–¥–µ–µ–≤ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∏–Ω–æ"
                3 -> "–ó–∞ –Ω–∞—É—á–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É"
                4 -> "–ó–∞ —Ç—Ä–æ–≥–∞—Ç–µ–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏ —Ü–∏—Ç–∞—Ç—ã –Ω–∞ –≤—Å—é –∂–∏–∑–Ω—å"
                5 -> "–ó–∞ –∏—Å—Ç–æ—Ä–∏—é –æ –Ω–∞–¥–µ–∂–¥–µ, –¥—Ä—É–∂–±–µ –∏ —Å–≤–æ–±–æ–¥–µ"
                6 -> "–ó–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∏ –¥–∏–∞–ª–æ–≥–∏ –¢–∞—Ä–∞–Ω—Ç–∏–Ω–æ"
                7 -> "–ó–∞ —ç–ø–∏—á–Ω—ã–π –º–∞—Å—à—Ç–∞–± –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–∏–ª–æ–≥–∏–∏"
                8 -> "–ó–∞ –¥—É—à–µ–≤–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –æ –¥—Ä—É–∂–±–µ –±–µ–∑ –≥—Ä–∞–Ω–∏—Ü"
                9 -> "–ó–∞ –≤–µ—á–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –≤–∑—Ä–æ—Å–ª–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏"
                10 -> "–ó–∞ –∫—É–ª—å—Ç–æ–≤—É—é —Ñ–∏–ª–æ—Å–æ—Ñ–∏—é –∏ —ç–∫—à–µ–Ω"
                11 -> "–ó–∞ –æ–¥–Ω—É –∏–∑ —Å–∞–º—ã—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª—é–±–æ–≤–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π"
                12 -> "–ó–∞ –≥–ª—É–±–æ–∫—É—é –¥—Ä–∞–º—É –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ—ç–Ω—Ç–µ–∑–∏-—ç–ª–µ–º–µ–Ω—Ç"
                else -> "–ó–∞ –æ—Ç–ª–∏—á–Ω—ã–π —Å—é–∂–µ—Ç –∏ –∞–∫—Ç–µ—Ä—Å–∫—É—é –∏–≥—Ä—É"
            }
        } ?: "–≠—Ç–æ—Ç —Ñ–∏–ª—å–º —Å—Ç–æ–∏—Ç –≤–∞—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏!"
    }
}